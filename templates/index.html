<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chatterhub</title>
  <!-- <link rel="stylesheet" href="/templates/index.css"/> -->
</head>
<body>
  <div class="container">
    <header>
      <h2>Chatterhub â€“ Group Chat</h2>
      <span id="client-id"></span>
    </header>

    <div id="messages" class="messages"></div>

    <form id="send-form">
      <input type="text" id="message" placeholder="Type messageâ€¦" autocomplete="off" required/>
      <button type="submit">Send</button>
      <button type="button" id="emoji-btn">ğŸ˜Š</button>
      <button type="button" id="loc-btn">ğŸ“</button>
      <button type="button" id="img-btn">ğŸ“·</button>
    </form>
  </div>

  <!-- <script src="/static/emoji-picker.js"></script> náº¿u báº¡n muá»‘n -->
  <script>
    const ws = new WebSocket(`${location.protocol==="https:"?"wss":"ws"}://${location.host}/ws`);
    const messagesDiv = document.getElementById('messages');
    const clientIdSpan = document.getElementById('client-id');
    const form = document.getElementById('send-form');
    const emojiBtn = document.getElementById('emoji-btn');
    const locBtn   = document.getElementById('loc-btn');
    const imgBtn   = document.getElementById('img-btn');

    // simple random client id
    const clientId = Math.random().toString(36).slice(2,8);
    clientIdSpan.textContent = `You: ${clientId}`;

    ws.onopen = () => {
      ws.send(JSON.stringify({client: clientId, content:`${clientId} joined`, type:"text"}));
    };

    ws.onmessage = e => {
      const d = JSON.parse(e.data);
      const p = document.createElement('p');
      if (d.type==="location"){
        p.innerHTML = `<b>${d.user}</b> shared location: <a target="_blank" href="https://maps.google.com/?q=${d.lat},${d.lon}">view</a>`;
      } else if (d.type==="emoji") {
        p.innerHTML = `<b>${d.user}</b>: ${d.content}`;
      } else {
        p.innerHTML = `<b>${d.user}</b>: ${d.content}`;
      }
      messagesDiv.prepend(p);
    };

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const msg = document.getElementById('message').value;
      ws.send(JSON.stringify({client:clientId,content:msg,type:"text"}));
      form.reset();
    });

    emojiBtn.onclick = ()=> {
      ws.send(JSON.stringify({client:clientId,content:"ğŸ˜Š",type:"emoji"}));
    };

    locBtn.onclick = ()=> {
      navigator.geolocation.getCurrentPosition(pos=>{
        ws.send(JSON.stringify({
          client:clientId,
          type:"location",
          lat: pos.coords.latitude,
          lon: pos.coords.longitude
        }));
      });
    };

    imgBtn.onclick = ()=> alert("Image upload is under development ğŸš§");
  </script>
</body>
</html>
